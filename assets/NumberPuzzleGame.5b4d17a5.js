import{r as f,o as Y,k as L,a as m,c as h,b as n,F as w,h as N,l as U,t as S,_ as W,m as y,v as b,p as Z,q as ee,j as te,d as X}from"./index.d90362ea.js";import{h as le,C as ae}from"./canvas2image.b3ef1181.js";var oe="/joy-toys/assets/header2.57d99039.png",se="/joy-toys/assets/743726__denkyschuk__happy-family-bpm-100-loop.5c0b1c51.mp3",ne="/joy-toys/assets/676457__stevenmaertens__wooden-blocks.66ae1041.mp3";const re=n("img",{src:W,alt:"bear-icon"},null,-1),ie=[re],ce={class:"modal fade box-view-modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ue={class:"modal-dialog modal-dialog-centered"},fe={class:"modal-content"},de=n("div",{class:"modal-header"},[n("h5",{class:"modal-title title-text",id:"exampleModalLabel"},"Rilakkuma Box"),n("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),_e={class:"modal-body"},me={class:"box box-list"},he={class:"box-inner"},pe={class:"list-item"},ve={class:"cell"},ge={class:"cell-num"},ye={__name:"NumberPuzzleGameViewModal",setup(A){const p=f([2,4,8,16,32,64,128,256,512,1024,2048,4096,8192]);let u=f(null);return Y(()=>{L(()=>{u.value.click()})}),(d,s)=>(m(),h(w,null,[n("button",{ref_key:"refModalBtn",ref:u,type:"button",class:"icon-btn btn-view","data-bs-toggle":"modal","data-bs-target":"#exampleModal"},ie,512),n("div",ce,[n("div",ue,[n("div",fe,[de,n("div",_e,[n("div",me,[n("ul",he,[(m(!0),h(w,null,N(p.value,c=>(m(),h("li",pe,[n("div",ve,[n("div",{class:U(["cell-inner",`style-${c}`])},[n("span",ge,S(c),1)],2)])]))),256))])])])])])])],64))}},be=n("span",{class:"material-symbols-outlined"},"download",-1),we=[be],ke={__name:"NumberPuzzleGameScreenshot",props:{timeString:String},emits:["eventDownloadImage"],setup(A,{emit:p}){const u=A,d=p;function s(){const c=new Date;d("eventDownloadImage",c)}return(c,g)=>(m(),h(w,null,[n("button",{onClick:g[0]||(g[0]=v=>s()),class:"icon-btn btn-download"},we),y(n("span",{class:"timestamp"},S(u.timeString),513),[[b,u.timeString]])],64))}};const xe=n("div",{class:"header-section"},[n("div",{class:"image-wrap"},[n("img",{src:oe,alt:"logo"})])],-1),$e=n("span",null,"Start",-1),Se=[$e],Ae={class:"score-text"},Me={key:0,class:"title-text"},je={class:"box-inner"},ze=n("span",{class:"material-symbols-outlined"},"music_note",-1),Ce=[ze],De=n("span",{class:"material-symbols-outlined"},"music_off",-1),Pe=[De],Le=n("source",{src:se,type:"audio/mpeg"},null,-1),Ne=[Le],Be=n("source",{src:ne,type:"audio/mpeg"},null,-1),Ee=[Be],i=4,$=0,Ie={__name:"NumberPuzzleGame",setup(A){const p=f(null),u=f(null),d=f(null),s=Z([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),c=f(!1),g=f(!1),v=f(!1),B=i-1,E=f(0),M=f("");function F(){let a=0,o=0;do a=Math.floor(Math.random()*(B-$+1))+$,o=Math.floor(Math.random()*(B-$+1))+$;while(s[a][o]!=0);return[a,o]}function k(a){let[o,l]=F();s[o][l]=a}function x(a){E.value+=a}async function O(){let a=!1;for(let o=0;o<i;o++){let l=[],t=[];for(let r=0;r<i;r++)l.push(s[r][o]),t.push(s[o][r]);(l.indexOf(0)!=-1||t.indexOf(0)!=-1)&&(a=!0)}return a}async function q(){let a=!1;for(let o=0;o<i;o++){let l=[],t=[];for(let r=0;r<i;r++)s[r][o]!=0&&l.push(s[r][o]),s[o][r]!=0&&t.push(s[o][r]);for(let r=0;r<l.length;r++)l[r]==l[r+1]&&(a=!0);for(let r=0;r<t.length;r++)t[r]==t[r+1]&&(a=!0)}return a}async function _(a){let o=await O(),l=await q();o?a&&(k(2),_(!1)):l||(g.value=!0)}function G(){let a=s.map(l=>l.slice());for(let l=0;l<i;l++){let t=[];for(let e=0;e<i;e++)s[e][l]!=0&&(t.push(s[e][l]),s[e][l]=0);for(let e=0;e<t.length;e++)t[e]==t[e+1]&&(t[e]=t[e]*2,t[e+1]=0,x(t[e]));let r=t.filter(e=>e!=0);for(let e=0;e<r.length;e++)s[e][l]=r[e]}let o=!1;for(let l=0;l<i;l++)for(let t=0;t<i;t++)a[t][l]!=s[t][l]&&(o=!0);return o}function T(){let a=s.map(l=>l.slice());for(let l=0;l<i;l++){let t=[];for(let e=0;e<i;e++)s[e][l]!=0&&(t.push(s[e][l]),s[e][l]=0);for(let e=t.length-1;e>0;e--)t[e]==t[e-1]&&(t[e]=t[e]*2,t[e-1]=0,x(t[e]));let r=t.filter(e=>e!=0);for(let e=0;e<r.length;e++){let P=i-r.length;s[e+P][l]=r[e]}}let o=!1;for(let l=0;l<i;l++)for(let t=0;t<i;t++)a[t][l]!=s[t][l]&&(o=!0);return o}function I(){let a=s.map(l=>l.slice());for(let l=0;l<i;l++){let t=[];for(let e=0;e<i;e++)s[l][e]!=0&&(t.push(s[l][e]),s[l][e]=0);for(let e=0;e<t.length;e++)t[e]==t[e+1]&&(t[e]=t[e]*2,t[e+1]=0,x(t[e]));let r=t.filter(e=>e!=0);for(let e=0;e<r.length;e++)s[l][e]=r[e]}let o=!1;for(let l=0;l<i;l++)for(let t=0;t<i;t++)a[l][t]!=s[l][t]&&(o=!0);return o}function R(){let a=s.map(l=>l.slice());for(let l=0;l<i;l++){let t=[];for(let e=0;e<i;e++)s[l][e]!=0&&(t.push(s[l][e]),s[l][e]=0);for(let e=t.length-1;e>0;e--)t[e]==t[e-1]&&(t[e]=t[e]*2,t[e-1]=0,x(t[e]));let r=t.filter(e=>e!=0);for(let e=0;e<r.length;e++){let P=i-r.length;s[l][e+P]=r[e]}}let o=!1;for(let l=0;l<i;l++)for(let t=0;t<i;t++)a[l][t]!=s[l][t]&&(o=!0);return o}function H(){c.value=!0,k(2),k(2),k(4)}function V(a){switch(a){case"play":v.value=!0,u.value.play();break;case"pause":v.value=!1,u.value.pause();break}}function J(a){M.value=a.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hourCycle:"h24",hour:"2-digit",minute:"2-digit"}),p.value.classList.add("print-style"),L(()=>{le(p.value).then(o=>{ae.saveAsPNG(o,o.width,o.height,`rilakkuma-puzzle_${a.getTime()}`)}).then(()=>{M.value="",p.value.classList.remove("print-style")})})}Y(()=>{document.addEventListener("keydown",a=>{if(g.value||!c.value)return;v.value&&(d.value.pause(),d.value.play());const o=a.key;let l=!0;switch(o){case"ArrowUp":a.preventDefault(),l=G(),_(l);break;case"ArrowDown":a.preventDefault(),l=T(),_(l);break;case"ArrowLeft":a.preventDefault(),l=I(),_(l);break;case"ArrowRight":a.preventDefault(),l=R(),_(l);break}}),L(()=>{u.value.volume=.5,d.value.volume=.6;let a=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${a}px`)})});let j=0,z=0,C=0,D=0;function K(a){j=a.touches[0].clientX,z=a.touches[0].clientY}function Q(a){if(!c.value)return;v.value&&(d.value.pause(),d.value.play()),C=a.changedTouches[0].clientX,D=a.changedTouches[0].clientY;let o=Math.abs(C-j),l=Math.abs(D-z),t=!0;o<l?z<D?(t=T(),_(t)):(t=G(),_(t)):j<C?(t=R(),_(t)):(t=I(),_(t))}return(a,o)=>(m(),h("div",{ref_key:"captureRef",ref:p,class:"number-puzzle-game"},[xe,y(n("button",{onClick:H,class:"normal-btn"},Se,512),[[b,!c.value]]),y(n("h4",Ae,[ee("Score:"),n("span",null,S(E.value),1)],512),[[b,c.value]]),g.value?(m(),h("h3",Me,"\u904A\u6232\u7D50\u675F")):te("",!0),n("div",{class:"box",onTouchstart:K,onTouchend:Q},[n("div",je,[(m(),h(w,null,N(i,(l,t)=>(m(),h(w,{key:t},[(m(),h(w,null,N(i,(r,e)=>n("div",{key:t+"-"+e,class:"cell"},[n("div",{class:U(["cell-inner",`style-${s[t][e]}`])},[y(n("span",{class:"cell-num"},S(s[t][e]),513),[[b,s[t][e]!=0]])],2)])),64))],64))),64))])],32),X(ye),X(ke,{timeString:M.value,onEventDownloadImage:J},null,8,["timeString"]),y(n("button",{onClick:o[0]||(o[0]=l=>V("pause")),class:"icon-btn btn-audio"},Ce,512),[[b,v.value]]),y(n("button",{onClick:o[1]||(o[1]=l=>V("play")),class:"icon-btn btn-audio"},Pe,512),[[b,!v.value]]),n("audio",{loop:"",ref_key:"refBgPlayer",ref:u},Ne,512),n("audio",{ref_key:"refEffectPlayer",ref:d},Ee,512)],512))}};export{Ie as default};
